// 1. Vue å¯¦ä¾‹ 
new Vue({
    el: '#app',
    data: {
        theme: localStorage.getItem('theme') || 'light'
    },
    methods: {
        toggleTheme() {
            this.theme = this.theme === 'light' ? 'dark' : 'light';
            localStorage.setItem('theme', this.theme);
            document.body.setAttribute('data-theme', this.theme);
        }
    },
    mounted() {
        // åˆå§‹åŒ–ä¸»é¡Œ
        document.body.setAttribute('data-theme', this.theme);
        initReminderLogic();
    }
});

// 2. å¥åº·æé†’åŠŸèƒ½çš„é‚è¼¯ 
function initReminderLogic() {
    const waterInput = document.getElementById('water-reminder');
    const mealInput = document.getElementById('meal-reminder');
    const saveBtn = document.getElementById('save-reminder');

    // è¼‰å…¥ä¸Šæ¬¡å„²å­˜çš„æ™‚é–“
    const savedWater = localStorage.getItem('water_time_val');
    const savedMeal = localStorage.getItem('meal_time_val');
    
    if(savedWater && waterInput) waterInput.value = savedWater;
    if(savedMeal && mealInput) mealInput.value = savedMeal;

    // å„²å­˜æŒ‰éˆ•äº‹ä»¶
    if(saveBtn) {
        saveBtn.addEventListener('click', () => {
            const wTime = waterInput.value;
            const mTime = mealInput.value;

            if (wTime) {
                scheduleReminder(wTime, 'è©²å–æ°´å›‰ï¼ä¿æŒæ°´å™¹å™¹ï¼ğŸ’§');
                localStorage.setItem('water_time_val', wTime);
            }
            if (mTime) {
                scheduleReminder(mTime, 'åƒé£¯æ™‚é–“åˆ°ï¼è¨˜å¾—ç´€éŒ„ç†±é‡å–”ï¼ğŸ±');
                localStorage.setItem('meal_time_val', mTime);
            }

            alert('âœ… è¨­å®šå·²å„²å­˜ï¼ç³»çµ±å°‡æœƒæº–æ™‚æé†’æ‚¨ã€‚');
        });
    }
}

// 3. æé†’è¨ˆæ™‚å™¨æ ¸å¿ƒé‚è¼¯
function scheduleReminder(time, message) {
    const [hours, minutes] = time.split(':').map(Number);
    const now = new Date();
    const reminderTime = new Date();
    
    reminderTime.setHours(hours, minutes, 0, 0);

    // å¦‚æœæ™‚é–“å·²ç¶“éäº†ï¼Œå°±è¨­ç‚ºæ˜å¤©
    if (reminderTime <= now) {
        reminderTime.setDate(reminderTime.getDate() + 1);
    }

    const timeout = reminderTime - now;
    
    // é–‹ç™¼è€…é™¤éŒ¯è¨Šæ¯
    console.log(`[ç³»çµ±] å·²è¨­å®šæé†’: "${message}"ï¼Œå°‡åœ¨ ${timeout/1000} ç§’å¾Œè§¸ç™¼`);
    
    // è¨­å®šè¨ˆæ™‚å™¨
    setTimeout(() => alert(`ğŸ”” æº«é¦¨æé†’ï¼š\n${message}`), timeout);
}